<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Persediaan</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="logo">
            <img src="../assets/logo.jpg" alt="Logo">
            <h2>Inventory</h2>
        </div>

        <nav>
            <a href="Index.html">Dashboard</a>
            <a href="Penjualan.html">Penjualan</a>
            <a href="Persediaan.html" class="active">Persediaan</a>
        </nav>
    </aside>

    <!-- CONTENT -->
    <main class="content">
        <header>
            <h1>Persediaan</h1>
            <p>Daftar stok produk</p>
        </header>

        <!-- SEARCH -->
        <div class="filter-bar">
            <input type="text" id="searchStock" placeholder="Cari SKU atau Nama Produk">
        </div>

        <!-- TABLE -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>Produk</th>
                        <th>Saldo Awal</th>
                        <th>Stok Masuk</th>
                        <th>Stok Keluar</th>
                        <th>Stok Akhir</th>
                    </tr>
                </thead>
                <tbody id="stokBody">
                   
                </tbody>
            </table>
        </div>
    </main>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz17HxhRGYKJdb7Iq_W7mCYUG3_gQbJMUJ61k4URCb_c343VlxnykmbgaxM_V5QizNb/exec";

const searchStock = document.getElementById("searchStock");
const tbody = document.getElementById("stokBody");

fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    const rows = data.persediaan;

    rows.slice(1).forEach(item => {
      const [sku, produk, saldoAwal, stokMasuk, stokKeluar, stokAkhir] = item;
      if (!sku) return;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${sku}</td>
        <td>${produk}</td>
        <td>${saldoAwal}</td>
        <td>${stokMasuk}</td>
        <td>${stokKeluar}</td>
        <td class="stock-value">${stokAkhir}</td>
      `;
      tbody.appendChild(tr);
    });

    applyStockColor();
    enableSearch();
  })
  .catch(err => console.error(err));

function applyStockColor() {
  document.querySelectorAll(".stock-value").forEach(cell => {
    const stock = parseInt(cell.innerText);
    cell.classList.remove("stock-safe","stock-warning","stock-danger");

    if (stock <= 20) {
      cell.classList.add("stock-danger");
    } else if (stock <= 100) {
      cell.classList.add("stock-warning");
    } else {
      cell.classList.add("stock-safe");
    }
  });
}

function enableSearch() {
  searchStock.addEventListener("keyup", () => {
    const keyword = searchStock.value.toLowerCase();
    document.querySelectorAll("#stokBody tr").forEach(row => {
      const sku = row.children[0].innerText.toLowerCase();
      const produk = row.children[1].innerText.toLowerCase();
      row.style.display =
        sku.includes(keyword) || produk.includes(keyword)
        ? ""
        : "none";
    });
  });
}
</script>

</body>
</html>